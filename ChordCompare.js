
inlets = 3;

outlets = 1;

var romanNumeralMap = {
	
  "empty" : 0,
  "I": 1, //do
  "I6": 2, //mi
  "Cad6/4": 3, //sol
  "iii": 4, //mi
  "vi": 5, //la
  "i": 6, //do
  "i6": 7, //me
  "Cad6/4(m)": 8, //sol
  "♭III": 9, //me
  "♭VI": 10, //le
  "IV": 11, //fa
  "IV6": 12, //la
  "ii": 13,//re
  "ii6": 14, //fa
  "ii6/5": 15, //fa
  "iv": 16, //fa
  "iv6": 17, //le
  "ii°6": 18, //fa
  "iiø6/5": 19, //fa
  "V": 20, //sol
  "V6": 21, //ti
  "V7": 22, //sol
  "V6/5": 23, //ti
  "V4/3": 24, //re
  "V4/2": 25, //fa
  "vii°6": 26, //re
  "viiø7": 27, //ti
  "viiø6/5": 28, //re
  "viiø4/3": 29, //fa 
  "viiø4/2": 30, //la
  "vii°7": 31, //ti
  "vii°6/5": 32, //re
  "vii°4/3": 33, //fa
  "vii°4/2": 34, //le
  "I+": 35, //do
  "V+": 36, //sol
  "It+6": 37, //le
  "Fr+6": 38, //le
  "Ger+6": 39, //le
  "III#": 40, //mi
  "VI#": 41, //la
  "V/V": 42, //re
  "V7/V": 43, //re
  "V6/V": 44, //fi
  "V6/5/V": 45, //fi
  "V4/3/V": 46, //la
  "V4/2/V": 47, //do
  "V7/IV": 48, //do
  "V6/5/IV": 49, //mi
  "V/ii": 50, //la
  "V7/ii": 51, //la
  "V6/ii": 52, //di
  "V6/5/ii": 53, //di
  "V4/3/ii": 54, //mi
  "V4/2/ii": 55, //sol
  "V/iii": 56, //ti
  "V7/iii": 57, //ti
  "V6/iii": 58, //ri
  "V6/5/iii": 59, //ri
  "V/vi": 60, //mi
  "V7/vi": 61, //mi
  "V6/vi": 62, //le
  "V6/5/vi": 63, //le
  "vii°6/V": 64, //la
  "viiø7/V": 65, //fi
  "vii°7/V": 66, //fi
  "vii°6/IV": 67, //sol
  "viiø7/IV": 68, //mi
  "vii°7/IV": 69, //mi
  "vii°6/ii": 70, //mi
  "vii°7/ii": 71, //di
  "vii°6/iii": 72, //fi
  "vii°7/iii": 73, //ri
  "vii°6/vi": 74, //ti
  "vii°7/vi": 75, //le
  "V/iv": 76, //do
  "V7/iv": 77, //do
  "V6/iv": 78, //mi
  "V6/5/iv": 79, //mi
  "vii°6/iv": 80, //sol
  "vii°7/iv": 81, //mi
  "V7/♭VI": 82, //ri
  "V7/♭III": 83, //te
  "V6/5/♭VI": 84, //sol
  "V6/5/♭III": 85, //re
  "V/♭VII": 86, //fa
  "V7/♭VII": 87, //fa
  "V6/♭VII": 88, //la
  "V6/5/♭VII": 89, //la
  "vii°6/♭III": 90, //fa
  "viiø7/♭III": 91, //re
  "vii°7/♭III": 92, //re
  "vii°6/♭VI": 93, //te
  "viiø7/♭VI": 94, //sol
  "vii°7/♭VI": 95, //sol
  "vii°6/♭VII": 96, //do
  "viiø7/♭VII": 97, //la
  "vii°7/♭VII": 98, //la
  "♭II6" : 99, //di
  "IV7" : 100, //fa
  "IV6/5" : 101, //la
  "iv7" : 102, //fa
  "iv6/5" : 103, //le

};


var closeChords = {
	1: [2, 3],
	2: [1, 3],
	3: [1, 2],
	4: [],
	5: [],
	6: [7, 8],
	7: [6, 8],
	8: [6, 7],
	9: [],
	10: [],
	11: [12, 86, 88, 100, 101],
	12: [11, 86, 88, 100, 101],
	13: [14, 15],
	14: [13, 15],
	15: [13, 14],
	16: [17, 102, 103],
	17: [16, 102, 103],
	18: [19],
	19: [18],
	20: [21, 22, 23, 24, 25],
	21: [20, 22, 23, 24, 25],
	22: [20, 21, 23, 24, 25],
	23: [20, 21, 22, 24, 25],
	24: [20, 21, 22, 23, 25],
	25: [20, 21, 22, 23, 24],
	26: [31, 32, 33, 34],
	31: [26, 32, 33, 34],
	32: [26, 31, 33, 34],
	33: [26, 31, 32, 34],
	34: [26, 31, 32, 33],	
	27: [28, 29, 30],
	28: [27, 29, 30],
	29: [27, 28, 30],
	30: [27, 28, 29],
	35: [1],
	36: [20],
	37: [38, 39],
	38: [37, 39],
	39: [37, 38],	
	40: [4],
	41: [5],
	42: [43, 44, 45, 46, 47, 48, 49],
	43: [42, 44, 45, 46, 47, 48, 49],
	44: [42, 43, 45, 46, 47, 48, 49],
	45: [42, 43, 44, 46, 47, 48, 49],
	46: [42, 43, 44, 45, 47, 48, 49],
	47: [42, 43, 44, 45, 46, 48, 49],
	48: [42, 43, 44, 45, 46, 47, 49],
	49: [42, 43, 44, 45, 46, 47, 48],
	50: [51, 52, 53, 54, 55],
	51: [50, 52, 53, 54, 55],
	52: [50, 51, 53, 54, 55],
	53: [50, 51, 52, 54, 55],	
	54: [50, 51, 52, 53, 55],
	55: [50, 51, 52, 53, 54],
	56: [57, 58, 59],
	57: [56, 58, 59],	
	58: [56, 57, 59],
	59: [56, 57, 58],
	60: [61, 62, 63],
	61: [60, 62, 63],
	62: [60, 61, 63],	
	63: [60, 61, 62],		
	64: [65, 66],
	65: [64, 66],
	66: [64, 65],
	67: [68, 69],
	68: [67, 69],
	69: [67, 68],
	70: [71],
	71: [70],
	72: [73],
	73: [72],
	74: [75],
	75: [74],
	76: [77, 78, 79],
	77: [76, 78, 79],
	79: [76, 77, 78],	
	80: [81],
	81: [80],
	82: [84],
	83: [85],
	84: [82],
	85: [83],
	86: [11, 12, 87, 88, 89],
	87: [86, 88, 89],
	88: [11, 12, 86, 87, 89],	
	89: [86, 87, 88],	
	90: [91, 92],
	91: [90, 92],
	92: [90, 91],
	93: [94, 95],
	94: [93, 95],
	95: [93, 94],
	96: [97, 98],
	97: [96, 98],
	98: [96, 97],
	99: [],
	100: [101, 11, 12, 86, 88],
	101: [100, 11, 12, 86, 88],
	102: [103, 16, 17],
	103: [102, 16, 17]
						
};

var sameBassChords = {
  1: [6, 35, 47, 48, 76, 77, 96],
  2: [4, 40, 49, 54, 60, 61, 68, 69, 70, 78, 79, 81],
  3: [8, 20, 22, 36, 55, 67, 80, 84, 94, 95],
  4: [2, 40, 49, 54, 60, 61, 68, 69, 70, 78, 79, 81],
  5: [12, 30, 41, 46, 50, 51, 64, 88, 89, 97, 98, 101],
  6: [1, 35, 47, 48, 76, 77, 96],
  7: [9, 58, 59, 73, 82],
  8: [3, 20, 22, 36, 55, 67, 80, 84, 94, 95],
  9: [7, 58, 59, 73, 82],
  10: [17, 34, 37, 38, 39, 62, 63, 75, 103],
  11: [14, 15, 16, 18, 19, 25, 29, 33, 86, 87, 90, 100, 102],
  12: [5, 30, 41, 46, 50, 51, 64, 88, 89, 97, 98, 101],
  13: [24, 26, 28, 32, 42, 43, 85, 91, 92],
  14: [11, 15, 16, 18, 19, 25, 29, 33, 86, 87, 90, 100, 102],
  15: [11, 14, 16, 18, 19, 25, 29, 33, 86, 87, 90, 100, 102],
  16: [11, 14, 15, 18, 19, 25, 29, 33, 86, 87, 90, 100, 102],
  17: [10, 34, 37, 38, 39, 62, 63, 75, 103],
  18: [11, 14, 15, 16, 19, 25, 29, 33, 86, 87, 90, 100, 102],
  19: [11, 14, 15, 16, 18, 25, 29, 33, 86, 87, 90, 100, 102],
  20: [3, 8, 22, 36, 55, 67, 80, 84, 94, 95],
  21: [23, 27, 31, 56, 57, 74],
  22: [3, 8, 20, 36, 55, 67, 80, 84, 94, 95],
  23: [21, 27, 31, 56, 57, 74],
  24: [13, 26, 28, 32, 42, 43, 85, 91, 92],
  25: [11, 14, 15, 16, 18, 19, 29, 33, 86, 87, 90, 100, 102],
  26: [13, 24, 28, 32, 42, 43, 85, 91, 92],
  27: [21, 23, 31, 56, 57, 74],
  28: [13, 24, 26, 32, 42, 43, 85, 91, 92],
  29: [11, 14, 15, 16, 18, 19, 25, 33, 86, 87, 90, 100, 102],
  30: [5, 12, 41, 46, 50, 51, 64, 88, 89, 97, 98, 101],
  31: [21, 23, 27, 56, 57, 74],
  32: [13, 24, 26, 28, 42, 43, 85, 91, 92],
  33: [11, 14, 15, 16, 18, 19, 25, 29, 86, 87, 90, 100, 102],
  34: [10, 17, 37, 38, 39, 62, 63, 75, 103],
  35: [1, 6, 47, 48, 76, 77, 96],
  36: [3, 8, 20, 22, 55, 67, 80, 84, 94, 95],
  37: [10, 17, 34, 38, 39, 62, 63, 75, 103],
  38: [10, 17, 34, 37, 39, 62, 63, 75, 103],
  39: [10, 17, 34, 37, 38, 62, 63, 75, 103],
  40: [2, 4, 49, 54, 60, 61, 68, 69, 70, 78, 79, 81],
  41: [5, 12, 30, 46, 50, 51, 64, 88, 89, 97, 98, 101],
  42: [13, 24, 26, 28, 32, 43, 85, 91, 92],
  43: [13, 24, 26, 28, 32, 42, 85, 91, 92],
  44: [45, 65, 66, 72],
  45: [44, 65, 66, 72],
  46: [5, 12, 30, 41, 50, 51, 64, 88, 89, 97, 98, 101],
  47: [1, 6, 35, 48, 76, 77, 96],
  48: [1, 6, 35, 47, 76, 77, 96],
  49: [2, 4, 40, 54, 60, 61, 68, 69, 70, 78, 79, 81],
  50: [5, 12, 30, 41, 46, 51, 64, 88, 89, 97, 98, 101],
  51: [5, 12, 30, 41, 46, 50, 64, 88, 89, 97, 98, 101],
  52: [53, 71, 99],
  53: [52, 71, 99],
  54: [2, 4, 40, 49, 60, 61, 68, 69, 70, 78, 79, 81],
  55: [3, 8, 20, 22, 36, 67, 80, 84, 94, 95],
  56: [21, 23, 27, 31, 57, 74],
  57: [21, 23, 27, 31, 56, 74],
  58: [7, 9, 59, 73, 82],
  59: [7, 9, 58, 73, 82],
  60: [2, 4, 40, 49, 54, 61, 68, 69, 70, 78, 79, 81],
  61: [2, 4, 40, 49, 54, 60, 68, 69, 70, 78, 79, 81],
  62: [10, 17, 34, 37, 38, 39, 63, 75, 103],
  63: [10, 17, 34, 37, 38, 39, 62, 75, 103],
  64: [5, 12, 30, 41, 46, 50, 51, 88, 89, 97, 98, 101],
  65: [44, 45, 66, 72],
  66: [44, 45, 65, 72],
  67: [3, 8, 20, 22, 36, 55, 80, 84, 94, 95],
  68: [2, 4, 40, 49, 54, 60, 61, 69, 70, 78, 79, 81],
  69: [2, 4, 40, 49, 54, 60, 61, 68, 70, 78, 79, 81],
  70: [2, 4, 40, 49, 54, 60, 61, 68, 69, 78, 79, 81],
  71: [52, 53, 99],
  72: [44, 45, 65, 66],
  73: [7, 9, 58, 59, 82],
  74: [21, 23, 27, 31, 56, 57],
  75: [10, 17, 34, 37, 38, 39, 62, 63, 103],
  76: [1, 6, 35, 47, 48, 77, 96],
  77: [1, 6, 35, 47, 48, 76, 96],
  78: [2, 4, 40, 49, 54, 60, 61, 68, 69, 70, 79, 81],
  79: [2, 4, 40, 49, 54, 60, 61, 68, 69, 70, 78, 81],
  80: [3, 8, 20, 22, 36, 55, 67, 84, 94, 95],
  81: [2, 4, 40, 49, 54, 60, 61, 68, 69, 70, 78, 79],
  82: [7, 9, 58, 59, 73],
  83: [93],
  84: [3, 8, 20, 22, 36, 55, 67, 80, 94, 95],
  85: [13, 24, 26, 28, 32, 42, 43, 91, 92],
  86: [11, 14, 15, 16, 18, 19, 25, 29, 33, 87, 90, 100, 102],
  87: [11, 14, 15, 16, 18, 19, 25, 29, 33, 86, 90, 100, 102],
  88: [5, 12, 30, 41, 46, 50, 51, 64, 89, 97, 98, 101],
  89: [5, 12, 30, 41, 46, 50, 51, 64, 88, 97, 98, 101],
  90: [11, 14, 15, 16, 18, 19, 25, 29, 33, 86, 87, 100, 102],
  91: [13, 24, 26, 28, 32, 42, 43, 85, 92],
  92: [13, 24, 26, 28, 32, 42, 43, 85, 91],
  93: [83],
  94: [3, 8, 20, 22, 36, 55, 67, 80, 84, 95],
  95: [3, 8, 20, 22, 36, 55, 67, 80, 84, 94],
  96: [1, 6, 35, 47, 48, 76, 77],
  97: [5, 12, 30, 41, 46, 50, 51, 64, 88, 89, 98, 101],
  98: [5, 12, 30, 41, 46, 50, 51, 64, 88, 89, 97, 101],
  99: [52, 53, 71],
  100: [11, 14, 15, 16, 18, 19, 25, 29, 33, 86, 87, 90, 102],
  101: [5, 12, 30, 41, 46, 50, 51, 64, 88, 89, 97, 98],
  102: [11, 14, 15, 16, 18, 19, 25, 29, 33, 86, 87, 90, 100],
  103: [10, 17, 34, 37, 38, 39, 62, 63, 75]
};


var correctChord = "empty";
var guessedChord = "empty";


function convertRomanToNumber(romanNumeral) {
    if (romanNumeral in romanNumeralMap) {
        return romanNumeralMap[romanNumeral];
    } else {
        return -1;
    }
}

function contains(arr, val) { //Going through the array
    for (var i = 0; i < arr.length; i++) {
        if (arr[i] === val) {
            return true;
        }
    }
    return false;
}


function bang() { // For the bang message, evaluates the score
    getChordScore(correctChord, guessedChord);
}

function msg_int(val) {
    if (inlet === 0) {
        getChordScore(correctChord, guessedChord);
    }
}

function anything() { // Inputs
    var input = messagename;
    if (inlet === 1) {
        correctChord = input;
    } else if (inlet === 2) {
        guessedChord = input;
    }
}

function getChordScore(correctChord, guessedChord) {
    var correctChordNum = convertRomanToNumber(correctChord);
    var guessedChordNum = convertRomanToNumber(guessedChord);

	var score = 4; //Default score
    
    if (guessedChordNum === 0) {
        post("No input");
		score = 4;
		
    } else if (correctChordNum === guessedChordNum) {
      	post("Perfect match!");
		score = 0;

    } else if (
        (closeChords[correctChordNum] && contains(closeChords[correctChordNum], guessedChordNum)) ||
        (closeChords[guessedChordNum] && contains(closeChords[guessedChordNum], correctChordNum))
    ) {
        post("Close match!");
		score = 1;
    } else if (
        (sameBassChords[correctChordNum] && contains(sameBassChords[correctChordNum], guessedChordNum)) ||
        (sameBassChords[guessedChordNum] && contains(sameBassChords[guessedChordNum], correctChordNum))
    ) {
        post("Same bass!");
		score = 2;

    } else {
        post("No match.");
		score = 3;
    }

	findChordScore(score);
}

function findChordScore(score) {
    outlet(0, score); // outputs score
}
